!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(t){"use strict";t.overlayMode=function(a,o,r){return{startState:function(){return{base:t.startState(a),overlay:t.startState(o),basePos:0,baseCur:null,overlayPos:0,overlayCur:null,streamSeen:null}},copyState:function(e){return{base:t.copyState(a,e.base),overlay:t.copyState(o,e.overlay),basePos:e.basePos,baseCur:null,overlayPos:e.overlayPos,overlayCur:null}},token:function(e,t){return(e!=t.streamSeen||Math.min(t.basePos,t.overlayPos)<e.start)&&(t.streamSeen=e,t.basePos=t.overlayPos=e.start),e.start==t.basePos&&(t.baseCur=a.token(e,t.base),t.basePos=e.pos),e.start==t.overlayPos&&(e.pos=e.start,t.overlayCur=o.token(e,t.overlay),t.overlayPos=e.pos),e.pos=Math.min(t.basePos,t.overlayPos),null==t.overlayCur?t.baseCur:null!=t.baseCur&&t.overlay.combineTokens||r&&null==t.overlay.combineTokens?t.baseCur+" "+t.overlayCur:t.overlayCur},indent:a.indent&&function(e,t,n){return a.indent(e.base,t,n)},electricChars:a.electricChars,innerMode:function(e){return{state:e.base,mode:a}},blankLine:function(e){var t,n;return a.blankLine&&(t=a.blankLine(e.base)),null==(n=o.blankLine?o.blankLine(e.overlay):n)?t:r&&null!=t?t+" "+n:n}}}}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(S){"use strict";function v(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function b(e,t){var n;return e?(n="",e=e instanceof RegExp?(e.ignoreCase&&(n="i"),e.unicode&&(n+="u"),e.source):String(e),new RegExp((!1===t?"":"^")+"(?:"+e+")",n)):/(?:)/}function y(e,t){(e.next||e.push)&&v(t,e.next||e.push),this.regex=b(e.regex),this.token=function(e){if(!e)return null;if(e.apply)return e;if("string"==typeof e)return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}(e.token),this.data=e}S.defineSimpleMode=function(e,t){S.defineMode(e,function(e){return S.simpleMode(e,t)})},S.simpleMode=function(e,t){v(t,"start");var n,a={},o=t.meta||{},r=!1;for(n in t)if(n!=o&&t.hasOwnProperty(n))for(var l=a[n]=[],s=t[n],i=0;i<s.length;i++){var c=s[i];l.push(new y(c,t)),(c.indent||c.dedent)&&(r=!0)}var d,u,h,m,p={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:r?[]:null}},copyState:function(e){var t={state:e.state,pending:e.pending,local:e.local,localState:null,indent:e.indent&&e.indent.slice(0)};e.localState&&(t.localState=S.copyState(e.local.mode,e.localState)),e.stack&&(t.stack=e.stack.slice(0));for(var n=e.persistentStates;n;n=n.next)t.persistentStates={mode:n.mode,spec:n.spec,state:n.state==e.localState?t.localState:S.copyState(n.mode,n.state),next:t.persistentStates};return t},token:(m=e,function(e,t){var n,a;if(t.pending)return a=t.pending.shift(),0==t.pending.length&&(t.pending=null),e.pos+=a.text.length,a.token;if(t.local)return t.local.end&&e.match(t.local.end)?(n=t.local.endToken||null,t.local=t.localState=null):(n=t.local.mode.token(e,t.localState),t.local.endScan&&(a=t.local.endScan.exec(e.current()))&&(e.pos=e.start+a.index)),n;for(var o=h[t.state],r=0;r<o.length;r++){var l=o[r],s=(!l.data.sol||e.sol())&&e.match(l.regex);if(s){if(l.data.next?t.state=l.data.next:l.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=l.data.push):l.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),l.data.mode){v=f=i=p=u=d=c=void 0;var i,c=m,d=t,u=l.data.mode,p=l.token;if(u.persistent)for(var f=d.persistentStates;f&&!i;f=f.next)(u.spec?function e(t,n){if(t===n)return!0;if(!t||"object"!=typeof t||!n||"object"!=typeof n)return!1;var a=0;for(var o in t)if(t.hasOwnProperty(o)){if(!n.hasOwnProperty(o)||!e(t[o],n[o]))return!1;a++}for(var o in n)n.hasOwnProperty(o)&&a--;return 0==a}(u.spec,f.spec):u.mode==f.mode)&&(i=f);var c=i?i.mode:u.mode||S.getMode(c,u.spec),v=i?i.state:S.startState(c);u.persistent&&!i&&(d.persistentStates={mode:c,spec:u.spec,state:v,next:d.persistentStates}),d.localState=v,d.local={mode:c,end:u.end&&b(u.end),endScan:u.end&&!1!==u.forceEnd&&b(u.end,!1),endToken:p&&p.join?p[p.length-1]:p}}l.data.indent&&t.indent.push(e.indentation()+m.indentUnit),l.data.dedent&&t.indent.pop();v=l.token;if(v&&v.apply&&(v=v(s)),2<s.length&&l.token&&"string"!=typeof l.token){for(var y=2;y<s.length;y++)s[y]&&(t.pending||(t.pending=[])).push({text:s[y],token:l.token[y-1]});return e.backUp(s[0].length-(s[1]?s[1].length:0)),v[0]}return v&&v.join?v[0]:v}}return e.next(),null}),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:(d=h=a,function(e,t,n){if(e.local&&e.local.mode.indent)return e.local.mode.indent(e.localState,t,n);if(null==e.indent||e.local||u.dontIndentStates&&-1<function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}(e.state,u.dontIndentStates))return S.Pass;var a=e.indent.length-1,o=d[e.state];e:for(;;){for(var r=0;r<o.length;r++){var l=o[r];if(l.data.dedent&&!1!==l.data.dedentIfLineStart){var s=l.regex.exec(t);if(s&&s[0]){a--,(l.next||l.push)&&(o=d[l.next||l.push]),t=t.slice(s[0].length);continue e}}}break}return a<0?0:e.indent[a]})};if(u=o)for(var f in o)o.hasOwnProperty(f)&&(p[f]=o[f]);return p}});